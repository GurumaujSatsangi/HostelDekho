<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    <title>Hostel Dekho</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />

  </head>
  <body>
    <%- include('partials/navbar') %>
    <main class="page-shell">
      
      <!-- Search Bar at Top -->
      <div class="search-bar-container">
        <div class="search-bar-wrapper">
          <i class="bi bi-search search-icon"></i>
          <input 
            type="text" 
            id="searchInput" 
            class="search-input" 
            placeholder="Search by Hostel Name..."
          />
        </div>
      </div>

      <!-- Layout Container with Sidebar and Content -->
      <div class="layout-with-sidebar">
        
        <!-- Left Sidebar with Filters -->
        <aside class="filter-sidebar">
          <div class="sidebar-header">
            <div style="display: flex; align-items: center; gap: 8px;">
              <i class="bi bi-funnel" style="color: var(--text);"></i>
              <h3 class="sidebar-title">Filters</h3>
            </div>
            <button id="clearFilters" class="btn-reset">
              Reset Filters
            </button>
          </div>

          <!-- Gender Filter -->
          <div class="filter-group">
            <h4 class="filter-label">Gender</h4>
            <div class="chip-group">
              <button class="filter-chip" data-filter="gender" data-value="MENS">Mens</button>
              <button class="filter-chip" data-filter="gender" data-value="LADIES">Ladies</button>
            </div>
          </div>

          <!-- Hostel Type Filter -->
          <div class="filter-group">
            <h4 class="filter-label">Hostel Type</h4>
            <div class="chip-group">
              <button class="filter-chip" data-filter="hostelType" data-value="AC">AC</button>
              <button class="filter-chip" data-filter="hostelType" data-value="NON AC">Non-AC</button>
            </div>
          </div>

          <!-- Bed Type Filter -->
          <div class="filter-group">
            <h4 class="filter-label">Bed Type</h4>
            <div class="chip-group">
              <button class="filter-chip" data-filter="bedType" data-value="BUNKER">Bunker</button>
              <button class="filter-chip" data-filter="bedType" data-value="NON BUNKER">Non-Bunker</button>
            </div>
          </div>

          <!-- Chota Dhobi Filter -->
          <div class="filter-group">
            <h4 class="filter-label">Chota Dhobi</h4>
            <div class="chip-group">
              <button class="filter-chip" data-filter="dhobi" data-value="Yes">Available</button>
              <button class="filter-chip" data-filter="dhobi" data-value="No">Not Available</button>
            </div>
          </div>

          <!-- Beds Available Filter -->
          <div class="filter-group">
            <h4 class="filter-label">Beds Available</h4>
            <div class="chip-group">
              <button class="filter-chip" data-filter="bedAvailability" data-value="1">1</button>
              <button class="filter-chip" data-filter="bedAvailability" data-value="2">2</button>
              <button class="filter-chip" data-filter="bedAvailability" data-value="3">3</button>
              <button class="filter-chip" data-filter="bedAvailability" data-value="4">4</button>
              <button class="filter-chip" data-filter="bedAvailability" data-value="6">6</button>
              <button class="filter-chip" data-filter="bedAvailability" data-value="8">8</button>
            </div>
          </div>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content">
          <div id="resultsCount" style="color: var(--text-dim); margin-bottom: 12px; font-weight: 500;"></div>
          
          <div id="hostelList">
      <% if(hosteldata && hosteldata.length>0){ %>
        <% hosteldata.forEach(function(hostel) { %>
        <div class="card">
          <div class="card-header">
            <div>
              <p class="card-title"><%= hostel.hostel_name %></p>
            </div>
            <% if(hostel.gender==="MENS") { %>

                                    <span class="chip-blue"><%= hostel.gender %></span>
<% } else { %>

                        <span class="chip-ladies"><%= hostel.gender %></span>
<% } %>
            <span class="chip"><%= hostel.bed_availability %></span>
            <span class="chip"><%= hostel.hostel_type %></span>
            <span class="chip"><%= hostel.bed_type %></span>
            <% if (hostel.chota_dhobi_facility === 'Yes') {%>

            <span class="chip">Chota Dhobi Facility : <%= hostel.chota_dhobi_facility %></span>

            <% } else { %>
            <span class="chip-no">Chota Dhobi Facility : <%= hostel.chota_dhobi_facility %></span>
<%}%>


          </div>
          <div class="card-content">
            <a
              href="/hostel/<%= hostel.hostel_id %>"
              class="btn btn-primary"
              style="width: fit-content"
            >
              Explore <i class="bi bi-arrow-right-circle-fill"></i>
            </a>
          </div>
        </div>
        <% }); %>
     
      <% } else {  %>
<h1>Coming Soon! <i class="bi bi-emoji-heart-eyes-fill"></i></h1>
        <% } %>
          </div>
        </div>
      </div>
    </main>

    <%- include('partials/footer') %>

    <script>
      // Search and Filter functionality with chips
      const searchInput = document.getElementById('searchInput');
      const clearFiltersBtn = document.getElementById('clearFilters');
      const hostelList = document.getElementById('hostelList');
      const resultsCount = document.getElementById('resultsCount');

      // Get all filter chips
      const filterChips = document.querySelectorAll('.filter-chip');
      
      // Active filters storage
      const activeFilters = {
        gender: [],
        hostelType: [],
        bedType: [],
        dhobi: [],
        bedAvailability: []
      };

      // Toggle chip selection
      filterChips.forEach(chip => {
        chip.addEventListener('click', function() {
          this.classList.toggle('active');
          const filterType = this.dataset.filter;
          const value = this.dataset.value;
          
          if (this.classList.contains('active')) {
            if (!activeFilters[filterType].includes(value)) {
              activeFilters[filterType].push(value);
            }
          } else {
            activeFilters[filterType] = activeFilters[filterType].filter(v => v !== value);
          }
          
          filterHostels();
        });
      });

      function filterHostels() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        const selectedGenders = activeFilters.gender;
        const selectedHostelTypes = activeFilters.hostelType;
        const selectedBedTypes = activeFilters.bedType;
        const selectedDhobi = activeFilters.dhobi;
        const selectedBedAvailability = activeFilters.bedAvailability;

        const cards = hostelList.querySelectorAll('.card');
        let visibleCount = 0;

        cards.forEach(card => {
          const hostelName = card.querySelector('.card-title')?.textContent.toLowerCase() || '';
          const genderChip = card.querySelector('.chip-blue, .chip-ladies')?.textContent.trim() || '';
          const chips = Array.from(card.querySelectorAll('.chip, .chip-no'));
          
          let hostelTypeText = '';
          let bedTypeText = '';
          let dhobiText = '';
          let bedAvailabilityText = '';

          chips.forEach(chip => {
            const text = chip.textContent.trim();
            if (text.includes('AC') || text.includes('NON AC')) {
              hostelTypeText = text;
            } else if (text.includes('BUNKER')) {
              bedTypeText = text;
            } else if (text.includes('Chota Dhobi')) {
              dhobiText = text.includes('Yes') ? 'Yes' : 'No';
            } else if (!isNaN(text)) {
              bedAvailabilityText = text;
            }
          });

          // Apply filters (if nothing is selected, show all)
          const matchesSearch = hostelName.includes(searchTerm);
          const matchesGender = selectedGenders.length === 0 || selectedGenders.includes(genderChip);
          const matchesHostelType = selectedHostelTypes.length === 0 || selectedHostelTypes.includes(hostelTypeText);
          const matchesBedType = selectedBedTypes.length === 0 || selectedBedTypes.includes(bedTypeText);
          const matchesDhobi = selectedDhobi.length === 0 || selectedDhobi.includes(dhobiText);
          const matchesBedAvailability = selectedBedAvailability.length === 0 || selectedBedAvailability.includes(bedAvailabilityText);

          const isVisible = matchesSearch && matchesGender && matchesHostelType && 
                           matchesBedType && matchesDhobi && matchesBedAvailability;

          card.style.display = isVisible ? 'block' : 'none';
          if (isVisible) visibleCount++;
        });

        // Update results count
        const totalCards = cards.length;
        resultsCount.textContent = `Showing ${visibleCount} of ${totalCards} hostels`;
      }

      // Event listeners
      searchInput.addEventListener('input', filterHostels);

      clearFiltersBtn.addEventListener('click', () => {
        searchInput.value = '';
        filterChips.forEach(chip => chip.classList.remove('active'));
        // Reset active filters
        Object.keys(activeFilters).forEach(key => activeFilters[key] = []);
        filterHostels();
      });

      // Initial count
      window.addEventListener('DOMContentLoaded', filterHostels);
    </script>
  </body>
</html>
